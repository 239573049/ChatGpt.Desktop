@namespace ChatGpt.Shared

@page "/"
@inject StorageJsInterop StorageJsInterop
@inject ChatGptJsInterop ChatGptJsInterop
@inject HttpClient HttpClient

<MApp Dark="ChatGptOptions.Dark" Id="inspire">
    <MNavigationDrawer @bind-Value="MiniVisible" App Dark="ChatGptOptions.Dark">
        <Dialogues OnClick="OnClickAsync" @bind-DialoguesModule="DialoguesModule"/>
    </MNavigationDrawer>

    <MAppBar Dark="ChatGptOptions.Dark" App>
        <MButton OnClick="() => MiniVisible = !MiniVisible" Icon>
            <MIcon>
                @(MiniVisible ? "mdi-dock-left" : "mdi-dock-right")
            </MIcon>
        </MButton>
        <MToolbarTitle>@DialoguesModule?.Title</MToolbarTitle>
        <MSpacer></MSpacer>

        <MMenu
            Bottom
            Left>
            <ActivatorContent>
                <MButton
                    Dark
                    Icon
                    Color="@(ChatGptOptions.Dark ? "" : "rgba(32,33,35,.5)")"
                    @attributes="@context.Attrs">
                    <MIcon>mdi-dots-vertical</MIcon>
                </MButton>
            </ActivatorContent>

            <ChildContent>
                <MList>
                    <Settings @bind-Value="settingVisible" 
                    OnSave="HandleOnSaveSetting" 
                    OnCancel="HandleOnCancelSetting" 
                    @bind-ChatGptOptions="ChatGptOptions" />

                    <MListItem OnClick="OnClear">
                        <MListItemContent>
                            <MListItemTitle>
                                清空当前对话
                            </MListItemTitle>
                        </MListItemContent>
                    </MListItem>
                </MList>
            </ChildContent>
        </MMenu>
        <MButton Dark="ChatGptOptions.Dark" OnClick="SerDark" Icon>
            <MIcon>
                @(ChatGptOptions.Dark ? "mdi-white-balance-sunny" : "mdi-weather-night")
            </MIcon>
        </MButton>
    </MAppBar>

    <MMain>
        <CahtMessage ChatGptOptions="ChatGptOptions" OnCopy="OnCopy" @bind-Messages="Messages" @ref="Message" />
    </MMain>
    <SendMessage SubmitChanged="OnSubmit"/>
    <PEnqueuedSnackbars @ref="_enqueuedSnackbars"></PEnqueuedSnackbars>
</MApp>